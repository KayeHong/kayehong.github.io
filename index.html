import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.pager.HorizontalPager
import androidx.compose.foundation.pager.rememberPagerState
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.unit.dp
import kotlinx.coroutines.launch

class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            MyApp()
        }
    }
}

@OptIn(ExperimentalFoundationApi::class)
@Composable
fun MyApp() {
    var items by remember { mutableStateOf((1..7).map { "Item $it" }.toMutableList()) }
    val pagerState = rememberPagerState(initialPage = 0)
    val coroutineScope = rememberCoroutineScope()

    Column(modifier = Modifier.fillMaxSize().padding(16.dp)) {
        HorizontalPager(
            pageCount = (items.size + 3) / 4,
            state = pagerState,
            modifier = Modifier.weight(1f)
        ) { page ->
            Column {
                for (i in 0 until 4) {
                    val index = page * 4 + i
                    if (index < items.size) {
                        Text(
                            text = items[index],
                            modifier = Modifier
                                .padding(8.dp)
                                .background(Color.Gray)
                                .padding(16.dp)
                        )
                    }
                }
            }
        }

        Button(onClick = {
            items.add("Item ${items.size + 1}")
            coroutineScope.launch {
                val newPage = (items.size - 1) / 4
                pagerState.scrollToPage(newPage)
            }
        }) {
            Text("Add Item")
        }
    }
}
